<div class="content">
    <div class="links">
        <a href="https://www.tektutorialshub.com/angular/nested-formarray-example-add-form-fields-dynamically/">techtutorialshub</a>
    </div>
    <h1>CD</h1>

    <!-- <form [formGroup]="editForm">
        <input type="text"
            formControlName="title">
    </form> -->

    <form class="emp-form"
        [formGroup]="cdForm"
        (ngSubmit)="onStoreCd()">
        <mat-form-field>
            <mat-label>title</mat-label>
            <input type="text"
                matInput
                formControlName="title">
        </mat-form-field>

        <form class="musicians-form-array"
            formArrayName="musiciansArray">
            <div *ngFor="let employee of musicians().controls; let empIndex=index">
                <div class="musician"
                    [formGroupName]="empIndex">

                    <mat-form-field>
                        <mat-label>{{empIndex}} First Name :</mat-label>
                        <input matInput
                            type="text"
                            formControlName="firstName" />
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label>Last Name:</mat-label>
                        <input matInput
                            type="text"
                            formControlName="lastName" />
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label>seq. nr.</mat-label>
                        <input matInput
                            type="number"
                            formControlName="seqNr" />
                    </mat-form-field>

                    <mat-icon (click)="removeMusician(empIndex)">delete_forever</mat-icon>


                    <div formArrayName="instruments">
                        <div *ngFor="let skill of instruments(empIndex).controls; let skillIndex=index">
                            <div [formGroupName]="skillIndex">

                                <mat-form-field>
                                    <mat-label>{{skillIndex}} Instrument :</mat-label>
                                    <input type="text"
                                        matInput
                                        formControlName="instrument" />
                                </mat-form-field>

                                <mat-form-field>
                                    <mat-label>seq. nr.:</mat-label>
                                    <input matInput
                                        type="number"
                                        formControlName="seqNr" />
                                </mat-form-field>
                                <mat-icon (click)="removeInstrument(empIndex,skillIndex)">delete_forever</mat-icon>
                            </div>
                        </div>
                    </div>
                    <button type="button"
                        mat-raised-button
                        color="primary"
                        (click)="addInstrument(empIndex)">
                        Add Instrument
                    </button>
                </div>
            </div>
            <button mat-raised-button
                type="button"
                color="primary"
                (click)="addMusician()">Add Musician</button>
        </form>
        <div class="reviews-form"
            formArrayName="reviews">
            <div *ngFor="let review of reviews().controls; let reviewIndex = index">
                <div [formGroupName]="reviewIndex">

                    <mat-form-field>
                        <mat-label>{{reviewIndex}} Review :</mat-label>
                        <input type="text"
                            matInput
                            formControlName="review" />
                    </mat-form-field>
                    <mat-form-field>
                        <mat-label>seq. nr :</mat-label>
                        <input type="number"
                            matInput
                            formControlName="seqNr" />
                    </mat-form-field>
                    <mat-icon (click)="removeReview(reviewIndex)">delete_forever</mat-icon>
                </div>
            </div>
            <button mat-raised-button
                type="button"
                color="primary"
                (click)="addReview()">add review</button>
        </div>
        <div class="image-section">
            <input type="file"
                style="display: none;"
                #fileInput
                (change)="fileInputChange($event)">
            <button mat-raised-button
                type="button"
                (click)="fileInput.click()">add image</button>
        </div>
        <button mat-raised-button
            type="submit">store Cd
        </button>
    </form>

    <div class="cds">
        @for(cd of cds$|async; track cd.id) {
        <div class="title">{{cd.title}}</div>
        <div class="buttons">
            <mat-icon (click)="onEdit(cd.id)">edit</mat-icon>
        </div>
        }
    </div>
    <pre>
        <code>

            {{cdForm.value|json}}
            <!-- {{cdForm.controls['musicians']}} -->
        </code>
    </pre>

</div>
